# LobbyLens Technical Debt

Concrete gaps and risks observed in the current repo. Items are grounded in code so they can be triaged and fixed.

- **Signals persisted locally only**: `run_daily_digest`/`run_mini_digest` now save signals, but stats and deduping still depend on SQLite unless `signals_database_url` points to Postgres. Impact: production may diverge unless we standardize on Postgres and add migrations; SQLite can still lock under concurrent web + worker load.
- **Slack endpoint configuration risk**: `bot/web_server.py` now verifies Slack signatures, but production depends on `SLACK_SIGNING_SECRET` being set correctly and monitored. Impact: misconfiguration fails closed; signatures should be tested regularly and ideally routed through the richer `bot/slack_app.py` handlers to avoid drift.
- **Production storage mismatch**: V2 defaults to a local SQLite `signals.db` in `bot/signals_database.py`, while LDA/V1 uses Postgres (`bot/database_postgres.py`) and the README advertises Railway/Postgres. Impact: divergent data sources between services, lack of migrations, and SQLite locking risk under concurrent web + worker load.
- **Fragile external API usage**: Calls to Congress.gov, Federal Register, and Regulations.gov in `bot/daily_signals.py` have no timeouts or retry/backoff strategy and reuse a single session for all hosts. A slow endpoint can hang the entire digest run and block Slack responses.
- **Heavy Regulations.gov comment scraping**: `_collect_regulations_gov_signals` and `_fetch_regulations_gov_comment_metrics` iterate up to 1000 documents and walk comments until a 48h window is exhausted, all inside the request path. Risk: long runtimes, API throttling, and hitting Slackâ€™s 3s slash command window.
- **Slack handler configuration drift**: `bot/web_server.py` now defaults to `SlackApp` (admin checks, confirmations, signature verification). The legacy handler remains behind `use_legacy_handlers` and should stay disabled in production to avoid divergence.
- **GovSearch service undocumented**: The `govsearch/` directory contains a FastAPI search service and Streamlit UI (`Dockerfile.govsearch`, `docker-compose.govsearch.yml`) but is not documented in README, operations guide, or architecture docs. Impact: unclear purpose, deployment status, and integration points for this service.
- **Security credential rotation urgency**: `SECURITY_CLEANUP.md` documents that credentials were exposed in git history (database passwords, Slack tokens, API keys) but rotation status is unclear. Impact: ongoing security risk if credentials haven't been rotated across all environments (GitHub Secrets, Railway, local `.env`).
- **No structured monitoring/observability**: Logging exists but no metrics collection, distributed tracing, or APM integration. Health checks were basic; a FastAPI `/health` now reports DB status, but no standardized metrics or alerts exist. Impact: difficult to diagnose production issues and track system health over time.
- **Missing data retention strategy**: No documented policy for archiving or cleaning old `signal_event` rows, LDA filings, or state files. SQLite databases can grow unbounded (`signals.db`, `signals_v2.db`). Impact: storage bloat, degraded query performance, and unclear data lifecycle.
- **Inconsistent error handling**: Some modules use try/except with logging (`bot/lda_etl.py`), others raise exceptions directly (`bot/run.py`), and `bot/web_server.py` catches all exceptions generically. No standardized error response format or error classification. Impact: unpredictable failure modes and difficult debugging.
- **No dependency update strategy**: `pyproject.toml` dependencies lack automated security scanning or update policies. No documented process for reviewing and applying security patches. Impact: potential vulnerabilities from outdated dependencies.
- **Missing backup/disaster recovery plan**: PostgreSQL (Railway) backups are managed by the provider, but no documented restore procedures, RTO/RPO targets, or testing schedule. SQLite databases have no backup strategy. Impact: data loss risk and unclear recovery procedures.
